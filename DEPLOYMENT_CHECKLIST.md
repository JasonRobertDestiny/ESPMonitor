# ESPMonitor 部署检查清单

使用此清单确保ESPMonitor系统正确部署

---

## 🔧 硬件准备

### ESP32检查
- [ ] ESP32开发板正常工作
- [ ] USB数据线连接正常
- [ ] 电源供应稳定(5V/1A+)

### 传感器检查
- [ ] DHT11/DHT22接线正确
  - [ ] VCC → 3.3V
  - [ ] GND → GND
  - [ ] DATA → GPIO4
- [ ] 水位传感器接线正确(可选)
  - [ ] VCC → 3.3V
  - [ ] GND → GND
  - [ ] AOUT → GPIO34
- [ ] LED接线正确(或使用GPIO2内置LED)

---

## 💻 软件准备

### Arduino IDE
- [ ] Arduino IDE已安装(1.8.19+或2.x)
- [ ] ESP32 Core已安装(2.0.0+)
- [ ] DHT sensor library已安装(1.4.4+)
- [ ] ArduinoJson已安装(6.21.0+)
- [ ] 串口驱动已安装(CP210x或CH340)

### Python环境
- [ ] Python 3.8+已安装
- [ ] pip已安装并可用
- [ ] Flask已安装(或准备安装)

### 网络环境
- [ ] ESP32和服务器在同一局域网
- [ ] WiFi为2.4GHz频段
- [ ] 防火墙允许端口5000

---

## ⚙️ 配置步骤

### ESP32配置
- [ ] 复制config.example.h为config.h
- [ ] 填写正确的WiFi SSID
- [ ] 填写正确的WiFi密码
- [ ] 填写正确的服务器URL(http://服务器IP:5000)
- [ ] 设置设备ID(可选自定义)

### 引脚配置(如需修改)
- [ ] DHT_PIN设置正确
- [ ] WATER_LEVEL_PIN设置正确
- [ ] ALERT_LED_PIN设置正确
- [ ] DHT_TYPE匹配实际传感器(DHT11或DHT22)

---

## 🚀 部署步骤

### 1. ESP32固件上传
- [ ] Arduino IDE打开ESPMonitor.ino
- [ ] 选择正确的开发板(ESP32 Dev Module)
- [ ] 选择正确的COM端口
- [ ] 编译成功(无错误)
- [ ] 上传成功
- [ ] 串口监视器显示正常启动信息

### 2. Flask服务器启动
- [ ] 进入server目录
- [ ] 安装依赖: `pip install -r requirements.txt`
- [ ] 启动服务器: `python app.py`
- [ ] 看到"Running on http://0.0.0.0:5000"
- [ ] 数据库初始化成功
- [ ] 阈值加载成功

### 3. Web界面访问
- [ ] 浏览器访问http://localhost:5000或http://服务器IP:5000
- [ ] 页面正常加载
- [ ] 样式显示正常
- [ ] 无JavaScript错误(F12查看控制台)

---

## ✅ 功能测试

### 基础通信
- [ ] ESP32成功连接WiFi(查看串口)
- [ ] ESP32显示获取的IP地址
- [ ] ESP32成功连接服务器
- [ ] 服务器收到数据(查看Flask日志)
- [ ] Web界面状态显示"在线"

### 传感器数据
- [ ] 温度数据正常显示(非NaN)
- [ ] 湿度数据正常显示(非NaN)
- [ ] 水位数据正常显示(0-100%)
- [ ] 数据每5秒自动更新
- [ ] 最后更新时间正确

### 阈值控制
- [ ] Web界面显示当前阈值
- [ ] 可以修改阈值数值
- [ ] 点击"更新阈值"后成功保存
- [ ] ESP32在10秒内获取新阈值(查看串口)
- [ ] 当前阈值显示更新

### 报警功能
- [ ] 设置阈值低于当前值
- [ ] Web界面对应卡片变色并闪烁
- [ ] ESP32 LED亮起
- [ ] 串口显示ALERT信息
- [ ] 恢复正常后LED熄灭

### 数据存储
- [ ] 历史数据表格显示数据
- [ ] 24小时统计显示正常
- [ ] 数据库文件已创建(database/espmonitor.db)

---

## 🔍 故障排查

### ESP32问题
| 症状 | 检查项 | 解决方案 |
|------|--------|----------|
| WiFi连接失败 | SSID/密码/频段 | 确认2.4GHz WiFi,密码正确 |
| 传感器NaN | 接线/传感器类型 | 检查接线,确认DHT_TYPE |
| HTTP -1错误 | 服务器IP/端口 | ping服务器,检查Flask启动 |
| 上传失败 | 驱动/端口 | 安装驱动,检查USB线 |

### 服务器问题
| 症状 | 检查项 | 解决方案 |
|------|--------|----------|
| 启动失败 | Python版本/依赖 | 确认Python 3.8+,重装依赖 |
| 端口被占用 | 5000端口 | 关闭占用进程或换端口 |
| 数据库错误 | 文件权限 | 检查database目录权限 |

### Web界面问题
| 症状 | 检查项 | 解决方案 |
|------|--------|----------|
| 无法访问 | URL/防火墙 | 检查IP和端口,关闭防火墙测试 |
| 显示离线 | ESP32运行/网络 | 检查ESP32串口,网络连通性 |
| 不更新 | JavaScript错误 | F12查看控制台错误 |

---

## 📊 性能验证

### 响应时间
- [ ] 传感器读取 < 1秒
- [ ] 数据发送 < 100ms
- [ ] Web界面加载 < 2秒
- [ ] 阈值更新 < 10秒

### 稳定性
- [ ] 连续运行1小时无错误
- [ ] WiFi断线后自动重连
- [ ] 服务器重启后ESP32自动恢复
- [ ] 多次刷新浏览器正常

### 准确性
- [ ] 温度误差 < ±2°C
- [ ] 湿度误差 < ±5%
- [ ] 时间戳准确
- [ ] 数据不丢失

---

## 🎯 生产环境建议

### 安全性
- [ ] 修改默认配置
- [ ] 添加API认证
- [ ] 使用HTTPS(可选)
- [ ] 限制访问IP

### 可靠性
- [ ] 使用UPS保证服务器电源
- [ ] ESP32使用稳定电源
- [ ] 定期备份数据库
- [ ] 监控系统状态

### 性能
- [ ] 使用Nginx反向代理
- [ ] 数据库定期清理
- [ ] 优化查询性能
- [ ] 考虑使用MySQL

---

## 📝 记录信息

### 系统信息
```
ESP32 IP: ___________________
服务器IP: ___________________
WiFi SSID: ___________________
设备ID: ___________________
```

### 阈值设置
```
温度阈值: _____°C
湿度阈值: _____%
水位阈值: _____%
```

### 部署日期
```
首次部署: ___________________
最后更新: ___________________
负责人: ___________________
```

---

## ✨ 验收标准

**系统可以交付使用的条件:**

1. ✅ ESP32稳定连接WiFi
2. ✅ 传感器数据准确可靠
3. ✅ 数据成功存储到数据库
4. ✅ Web界面实时显示数据
5. ✅ 阈值控制功能正常
6. ✅ 报警功能正常触发
7. ✅ 连续运行24小时无故障
8. ✅ 文档完整,用户可自行维护

---

**当所有检查项都打✓时,系统部署完成!**

部署完成日期: __________________

部署人员签名: __________________
